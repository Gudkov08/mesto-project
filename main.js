(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"];function t(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var n={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},r=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled=!0)};function o(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}function c(e){e.target.classList.contains("popup")&&a(document.querySelector(".popup_opened"))}function i(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o),e.addEventListener("click",c)}function a(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o),e.removeEventListener("click",c)}var u=document.forms.deleteCard,l={baseUrl:"https://nomoreparties.co/v1/plus-cohort-1",headers:{Authorization:"4ac8521d-70a9-440e-8460-55ec053aa485","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))};function d(e){e.querySelector(n.formSelector).reset(),e.querySelector(n.submitButtonSelector).disabled=!0,e.querySelector(n.submitButtonSelector).classList.add(n.inactiveButtonClass)}var f=document.querySelector("input[name=profile-name]"),m=document.querySelector("input[name=profile-description]"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),_=document.querySelector(".profile__img"),p=document.querySelector("#POPUP-EDIT-PROFILE"),h=p.querySelector(".form__submit"),S={};function b(e){v.textContent=e.name,y.textContent=e.about,_.src=e.avatar,function(e){Object.assign(S,e)}(e)}var E=document.querySelector("#POPUP-CHANGE-AVATAR"),q=document.querySelector("#POPUP-DELETE-CARD");function L(e,t){var n=document.querySelector("#AddNewCard").content.querySelector(".elements__card").cloneNode(!0),r=n.querySelector(".elements__card-image"),o=n.querySelector(".elements__card-title"),c=n.querySelector(".elements__likes-number");o.textContent=e.name,r.alt=e.name,r.src=e.link,c.textContent=e.likes.length;var d=n.querySelector(".elements__card-button");e.likes.some((function(e){if(e._id===t._id)return!0}))&&d.classList.add("elements__card-button_active"),d.addEventListener("click",(function(t){var n=t.target;d.classList.contains("elements__card-button_active")?function(e){return fetch("".concat(l.baseUrl,"/cards/likes/")+e._id,{method:"DELETE",headers:l.headers}).then(s)}(e).then((function(e){c.textContent=e.likes.length,n.classList.remove("elements__card-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/")+e._id,{method:"PUT",headers:l.headers}).then(s)}(e).then((function(e){c.textContent=e.likes.length,n.classList.add("elements__card-button_active")})).catch((function(e){console.log(e)}))}));var f=n.querySelector(".button_type_trash");e.owner._id!=t._id&&f.remove(),f.addEventListener("click",(function(){i(q),u.addEventListener("submit",(function t(n){n.preventDefault(),function(e){return fetch("".concat(l.baseUrl,"/cards/")+e._id,{method:"DELETE",headers:l.headers}).then(s)}(e).then((function(){f.closest(".elements__card").remove(),u.removeEventListener("submit",t),a(q)})).catch((function(e){console.log(e)}))}))}));var m=n.querySelector(".elements__card-image"),v=document.querySelector("#POPUP-IMAGE-LARGE");return m.addEventListener("click",(function(e){i(v);var t=v.querySelector(".imgPopup__image"),n=v.querySelector(".imgPopup__caption");t.src=r.src,n.textContent=o.textContent})),n}var C,g,k,P=document.querySelector(".elements__list");function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Promise.all([fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(s),fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(s)]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];!function(e,t){e.reverse(),e.forEach((function(e){var n=L(e,t);P.prepend(n)}))}(n,r),b(r)})).catch((function(e){console.log(e)})),g=(C=n).formSelector,k=t(C,["formSelector"]),Array.from(document.querySelectorAll(g)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(n.querySelectorAll(".form__set")).forEach((function(n){!function(n,o){var c=o.inputSelector,i=o.submitButtonSelector,a=o.inactiveButtonClass,u=t(o,e),l=Array.from(n.querySelectorAll(c)),s=n.querySelector(i);r(l,s,a),l.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n){var r=n.inputErrorClass,o=n.errorClass;t.validity.valid?function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.classList.remove(r),o.textContent=""}(e,t,r,o):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),c.textContent=n,c.classList.add(o)}(e,t,t.validationMessage,r,o)}(n,e,u),r(l,s,a)}))}))}(n,k)}))}));var x=document.querySelector(".button_type_edit"),O=document.forms.editProfile,w=document.querySelector(".profile__add-btn"),U=document.forms.newCard,D=document.querySelector("#POPUP-IMAGE-LARGE"),j=document.querySelector("#POPUP-NEW-CARD"),T=document.forms.changeAvatar;x.addEventListener("click",(function(){i(p),f.value=v.textContent,m.value=y.textContent})),p.querySelector(".button_type_close").addEventListener("click",(function(){a(p)})),O.addEventListener("submit",(function(e){var t,n;e.preventDefault(),h.textContent="Сохранение...",(t=f.value,n=m.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then(s)).then((function(){v.textContent=f.value,y.textContent=m.value,a(p),d(p)})).catch((function(e){console.log(e)})).finally((function(){h.textContent="Сохранить"}))})),w.addEventListener("click",(function(){i(j)})),j.querySelector(".button_type_close").addEventListener("click",(function(){a(j)})),U.addEventListener("submit",(function(e){var t,n=document.querySelector("#POPUP-NEW-CARD"),r=n.querySelector(".form__submit"),o={};o.name=n.querySelector("input[name=newCardName]").value,o.link=n.querySelector("input[name=newCardLink]").value,e.preventDefault(),r.textContent="Сохранение...",(t=o,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t.name,link:t.link})}).then(s)).then((function(e){o.likes=e.likes,o.owner=e.owner,o.owner._id=e.owner._id,o._id=e._id;var t=L(o,S);P.prepend(t),a(n),d(n)})).catch((function(e){console.log(e)})).finally((function(){r.textContent="Создать"}))})),D.querySelector(".button_type_close").addEventListener("click",(function(){a(D)})),_.addEventListener("click",(function(){i(E)})),E.querySelector(".button_type_close").addEventListener("click",(function(){a(E)})),T.addEventListener("submit",(function(e){var t,n=E.querySelector("input[name=newAvatarLink]").value,r=E.querySelector(".form__submit");e.preventDefault(),r.textContent="Загрузка...",(t=n,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(s)).then((function(){_.src=n,a(E),d(E)})).catch((function(e){console.log(e)})).finally((function(){r.textContent="Сохранить"}))})),q.querySelector(".button_type_close").addEventListener("click",(function(){a(q)}))})();